<munit:test name="{{ test_name }}" description="Test for {{ flow_name }}">
  <munit:behavior>
    {% for mock in mocks %}
    <mock:when processor="{{ mock.processor }}" doc:name="Mock {{ mock.processor }}">
      {% if mock.payload %}
      <mock:with-attributes>
        <mock:equal-to name="config-ref" value="{{ mock.config_ref }}" />
      </mock:with-attributes>
      <mock:then-return>
        <mock:payload><![CDATA[{{ mock.payload }}]]></mock:payload>
      </mock:then-return>
      {% endif %}
    </mock:when>
    {% endfor %}
  </munit:behavior>
</munit:test>